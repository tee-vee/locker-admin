# Derek Yuen <derekyuen@lockerlife.hk>
# January 2017
# Bootstrap script for use with http://boxstarter.org/
# To use append the URL to the raw snippet to http://boxstarter.org/package/nr/url? (e.g. http://boxstarter.org/package/nr/url?http://lockerlife.hk/deploy/....txt)

<<<<<<< HEAD

#
# Create temp dir
#
mkdir c:\temp


#
# Set System time zone and time (via NTP)
#
=======
# Create temp dir
mkdir c:\temp

# Set System time zone and time (via NTP)
>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e
%windir\System32\%tzutil.exe /s "China Standard Time"
%windir%\System32\tzutil.exe /g
%windir%\System32\w32tm.exe /config /syncfromflags:manual /manualpeerlist:"stdtime.gov.hk 0.asia.pool.ntp.org 3.asia.pool.ntp.org"

<<<<<<< HEAD

#
# Windows Settings
#
=======
# Windows Settings
>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e
Set-ExplorerOptions -showFileExtensions
Update-ExecutionPolicy RemoteSigned
Disable-MicrosoftUpdate
Disable-UAC
Disable-BingSearch
Set-WindowsExplorerOptions -DisableShowHiddenFilesFoldersDrives -DisableShowProtectedOSFiles -DisableShowFileExtensions -DisableShowFullPathInTitleBar -DisableOpenFileExplorerToQuickAccess -DisableShowRecentFilesInQuickAccess -DisableShowFrequentFoldersInQuickAccess -DisableExpandToOpenFolder
Set-TaskbarOptions -Size Small -Lock -Dock Bottom

<<<<<<< HEAD

#
# Windows updates & features
#
=======
# Windows updates & features
>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e
cinst dotnet4.6.2
## cinst powershell4
cinst microsoftsecurityessentials

<<<<<<< HEAD

#
# local primary dependencies
#
=======
# local primary dependencies
>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e
cinst git.install -params '"/WindowsTerminal /GitOnlyOnPath /NoAutoCrlf"'
cinst teamviewer
cinst pstools
cinst curl
cinst gow
cinst nssm
cinst wget
cinst jq
<<<<<<< HEAD
cinst whois
=======
>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e
cinst 7zip
cinst boxstarter.common
cinst boxstarter.winconfig
cinst chocolatey

<<<<<<< HEAD
#
=======
>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e
# secondary dependencies
cinst fciv
cinst vim
cinst clink
cinst putty
cinst winscp
cinst rsync
cinst which
cinst pswindowsupdate
cinst handle
cinst notepadplusplus
cinst teraterm

<<<<<<< HEAD
#
# test curl
curl http://httpbin.org/ip


#
=======
# test curl
curl http://httpbin.org/ip

>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e
# apply hotfix
# See: https://support.microsoft.com/en-us/kb/2889748
cd c:\temp
%windir%\System32\net.exe stop wuauserv
"%programfiles%\Gow\bin\curl.exe" -o "c:\temp" --url "http://hotfixv4.microsoft.com/Windows%207/Windows%20Server2008%20R2%20SP1/sp2/Fix475191/7600/free/468848_intl_i386_zip.exe"
"%programfiles%\7-zip\7z.exe" e -y c:\temp\hotfix.exe
%windir%\System32\wusa.exe c:\temp\Windows6.1-KB2889748-x86.msu /passive /quiet /norestart

<<<<<<< HEAD
#
# light cleanup
#
del /q c:\temp\*.exe
del /q c:\temp\*.msu
del /q %userprofile%\*.lnk

#
# prompt to scan sim card; capture input


#
# get install
#
git clone https://lockerlife-kiosk:Locision123@github.com/tee-vee/locker-admin.git c:\temp

#
# get new powershell
#
#curl -k -o c:\temp\Windows6.1-KB2506143-x86.msu --url "https://download.microsoft.com/download/E/7/6/E76850B8-DA6E-4FF5-8CCE-A24FC513FD16/Windows6.1-KB2506143-x86.msu"
#%windir%\System32\wusa.exe c:\temp\Windows6.1-KB2506143-x86.msu /passive /quiet /norestart


#
# generate call to next stage ...
#
echo.
set _stage2=%userprofile%\Desktop\setup-locker-stage2.cmd
type NUL > %_stage2%
echo "@echo off" >> %_stage2%
echo "" >> %_stage2%
echo "START http://boxstarter.org/package/nr/url?http://lockerlife.hk/deploy/deploy-locker-p2.txt"

echo "

#
# reboot
#
#echo.
echo "Will reboot in 10 seconds"
echo "use cancel-shutdown on desktop to abort shutdown"
echo "%windir%\System32\shutdown.exe /a" > %userprofile%\Desktop\CANCEL-SHUTDOWN.cmd
timeout /T 15
#%windir%\System32\shutdown.exe /r /t 11 /d p:02:04 /c "LockerLife Locker Deployment Stage 1" 
=======
del /q c:\temp\*.exe
del /q c:\temp\*.msu

# get install
git clone https://lockerlife-kiosk:Locision123@github.com/tee-vee/locker-admin.git c:\temp



>>>>>>> 0604056cb03b41a1b2c132dcad9df2b3711ce59e

